{"version":3,"file":"erpnext-web.min.js","sources":["../../../apps/erpnext/erpnext/public/js/website_utils.js","../../../apps/vim/vim/public/js/shopping_cart.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nif(!window.erpnext) window.erpnext = {};\n\n// Add / update a new Lead / Communication\n// subject, sender, description\nfrappe.send_message = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"erpnext.templates.utils.send_message\",\n\t\tbtn: btn,\n\t\targs: opts,\n\t\tcallback: opts.callback\n\t});\n};\n\nerpnext.subscribe_to_newsletter = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"frappe.email.doctype.newsletter.newsletter.subscribe\",\n\t\tbtn: btn,\n\t\targs: {\"email\": opts.email},\n\t\tcallback: opts.callback\n\t});\n}\n\n// for backward compatibility\nerpnext.send_message = frappe.send_message;\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// shopping cart\nfrappe.provide(\"erpnext.shopping_cart\");\nvar shopping_cart = erpnext.shopping_cart;\n\nvar getParams = function (url) {\n\tvar params = [];\n\tvar parser = document.createElement('a');\n\tparser.href = url;\n\tvar query = parser.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tparams[pair[0]] = decodeURIComponent(pair[1]);\n\t}\n\treturn params;\n};\n\nfrappe.ready(function() {\n\tvar full_name = frappe.session && frappe.session.user_fullname;\n    if(!frappe.session || frappe.session.user =='Guest'){\n        $('li a[href=\"/customer_details\"]').toggleClass('hidden',true)\n    }\n    \n\t// update user\n\tif(full_name) {\n\t\t$('.navbar li[data-label=\"User\"] a')\n\t\t\t.html('<i class=\"fa fa-fixed-width fa fa-user\"></i> ' + full_name);\n\t}\n\t// set coupon code and sales partner code\n\n\tvar url_args = getParams(window.location.href);\n\n\tvar referral_coupon_code = url_args['cc'];\n\tvar referral_sales_partner = url_args['sp'];\n\n\tvar d = new Date();\n\t// expires within 30 minutes\n\td.setTime(d.getTime() + (0.02 * 24 * 60 * 60 * 1000));\n\tvar expires = \"expires=\"+d.toUTCString();\n\tif (referral_coupon_code) {\n\t\tdocument.cookie = \"referral_coupon_code=\" + referral_coupon_code + \";\" + expires + \";path=/\";\n\t}\n\tif (referral_sales_partner) {\n\t\tdocument.cookie = \"referral_sales_partner=\" + referral_sales_partner + \";\" + expires + \";path=/\";\n\t}\n\treferral_coupon_code=frappe.get_cookie(\"referral_coupon_code\");\n\treferral_sales_partner=frappe.get_cookie(\"referral_sales_partner\");\n\n\tif (referral_coupon_code && $(\".tot_quotation_discount\").val()==undefined ) {\n\t\t$(\".txtcoupon\").val(referral_coupon_code);\n\t}\n\tif (referral_sales_partner) {\n\t\t$(\".txtreferral_sales_partner\").val(referral_sales_partner);\n\t}\n\t// update login\n\tshopping_cart.show_shoppingcart_dropdown();\n\tshopping_cart.set_cart_count();\n\tshopping_cart.bind_dropdown_cart_buttons();\n\tshopping_cart.show_cart_navbar();\n});\n\n$.extend(shopping_cart, {\n\tshow_shoppingcart_dropdown: function() {\n\t\t$(\".shopping-cart\").on('shown.bs.dropdown', function() {\n\t\t\tif (!$('.shopping-cart-menu .cart-container').length) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: 'erpnext.shopping_cart.cart.get_shopping_cart_menu',\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tupdate_cart: function(opts) {\n        // console.log(\"opts\",opts);\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tif(localStorage) {\n\t\t\t\tlocalStorage.setItem(\"last_visited\", window.location.pathname);\n\t\t\t}\n\t\t\twindow.location.href = \"/login\";\n\t\t} else {\n            // console.log(\"opts.slot\",opts.slot,opts)\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"POST\",\n\t\t\t\tmethod: \"erpnext.shopping_cart.cart.update_cart\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: opts.item_code,\n\t\t\t\t\tqty: opts.qty,\n\t\t\t\t\tadditional_notes: opts.additional_notes !== undefined ? opts.additional_notes : undefined,\n\t\t\t\t\twith_items: opts.with_items || 0,\n                    slot: opts.slot !== undefined ? opts.slot : undefined,\n                    delivery_date: opts.delivery_date !== undefined ? opts.delivery_date : undefined , \n                    brand: opts.brand !== undefined ? opts.brand : undefined,\n                    branch: opts.branch !== undefined ? opts.branch : undefined,\n                    city: opts.city !== undefined ? opts.city : undefined ,\n                    phone: opts.phone !== undefined ? opts.phone : undefined,\n\t\t\t\t\tuom: opts.uom !== undefined ? opts.uom : undefined\n\n\t\t\t\t},\n\t\t\t\tbtn: opts.btn,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tshopping_cart.set_cart_count();\n\t\t\t\t\tif (r.message.shopping_cart_menu) {\n\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message.shopping_cart_menu);\n\t\t\t\t\t}\n\t\t\t\t\tif(opts.callback)\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_cart_count: function() {\n\t\tvar cart_count = frappe.get_cookie(\"cart_count\");\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tcart_count = 0;\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$(\".shopping-cart\").toggleClass('hidden', false);\n\t\t}\n\n\t\tvar $cart = $('.cart-icon');\n\t\tvar $badge = $cart.find(\"#cart-count\");\n\n\t\tif(parseInt(cart_count) === 0 || cart_count === undefined) {\n\t\t\t$cart.css(\"display\", \"none\");\n\t\t\t$(\".cart-items\").html('Cart is Empty');\n\t\t\t$(\".cart-tax-items\").hide();\n\t\t\t$(\".btn-place-order\").hide();\n\t\t\t$(\".cart-addresses\").hide();\n\t\t}\n\t\telse {\n\t\t\t$cart.css(\"display\", \"inline\");\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$badge.html(cart_count);\n\t\t} else {\n\t\t\t$badge.remove();\n\t\t}\n\t},\n\n\tshopping_cart_update: function({item_code, qty, cart_dropdown, additional_notes}) {\n\t\tfrappe.freeze();\n\t\tshopping_cart.update_cart({\n\t\t\titem_code,\n\t\t\tqty,\n\t\t\tadditional_notes,\n\t\t\twith_items: 1,\n\t\t\tbtn: this,\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.unfreeze();\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\t// $(\".cart-items\").html(r.message.items);\n\t\t\t\t\tvar item_cart = document.getElementsByClassName(\"cart-items\")[0];\n\t\t\t\t\titem_cart.innerHTML = r.message.items;\n\t\t\t\t\t$(\".cart-tax-items\").html(r.message.taxes);\n\t\t\t\t\tif (cart_dropdown != true) {\n\t\t\t\t\t\t$(\".cart-icon\").hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\n\tbind_dropdown_cart_buttons: function () {\n\t\t$(\".cart-icon\").on('click', '.number-spinner button', function () {\n\t\t\tvar btn = $(this),\n\t\t\t\tinput = btn.closest('.number-spinner').find('input'),\n\t\t\t\toldValue = input.val().trim(),\n\t\t\t\tnewVal = 0;\n\n\t\t\tif (btn.attr('data-dir') == 'up') {\n\t\t\t\tnewVal = parseInt(oldValue) + 1;\n\t\t\t} else {\n\t\t\t\tif (oldValue > 1) {\n\t\t\t\t\tnewVal = parseInt(oldValue) - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinput.val(newVal);\n\t\t\tvar item_code = input.attr(\"data-item-code\");\n\t\t\tshopping_cart.shopping_cart_update({item_code, qty: newVal, cart_dropdown: true});\n\t\t\treturn false;\n\t\t});\n\n\t},\n\n\tshow_cart_navbar: function () {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.shopping_cart.doctype.shopping_cart_settings.shopping_cart_settings.is_cart_enabled\",\n\t\t\tcallback: function(r) {\n\t\t\t\t$(\".shopping-cart\").toggleClass('hidden', r.message ? false : true);\n\t\t\t}\n\t\t});\n\t}\n});\n"],"names":["window","erpnext","frappe","send_message","opts","btn","call","type","method","args","callback","subscribe_to_newsletter","email","provide","shopping_cart","ready","full_name","session","user_fullname","user","$","toggleClass","html","url_args","url","params","parser","document","createElement","href","vars","search","substring","split","i","length","pair","decodeURIComponent","getParams","location","referral_coupon_code","referral_sales_partner","d","Date","setTime","getTime","expires","toUTCString","cookie","get_cookie","undefined","val","show_shoppingcart_dropdown","set_cart_count","bind_dropdown_cart_buttons","show_cart_navbar","extend","on","r","message","update_cart","item_code","qty","additional_notes","with_items","slot","delivery_date","brand","branch","city","phone","uom","shopping_cart_menu","localStorage","setItem","pathname","cart_count","$cart","$badge","find","parseInt","css","hide","remove","shopping_cart_update","ref","freeze","this","unfreeze","exc","getElementsByClassName","innerHTML","items","taxes","cart_dropdown","input","closest","oldValue","trim","newVal","attr"],"mappings":"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"}