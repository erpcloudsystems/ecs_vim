{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/vim/vim/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js","../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js","../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js","../../../apps/erpnext/erpnext/public/js/telephony.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_or_batch_no: function() {\n\t\tlet grid_row = cur_frm.open_grid_row();\n\t\tif (!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status() !== \"Write\") return;\n\n\t\tfrappe.model.get_value('Item', {'name': grid_row.doc.item_code},\n\t\t\t['has_serial_no', 'has_batch_no'], ({has_serial_no, has_batch_no}) => {\n\t\t\t\tObject.assign(grid_row.doc, {has_serial_no, has_batch_no});\n\n\t\t\t\tif (has_serial_no) {\n\t\t\t\t\tattach_selector_button(__(\"Add Serial No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.$wrapper, this, grid_row);\n\t\t\t\t} else if (has_batch_no) {\n\t\t\t\t\tattach_selector_button(__(\"Pick Batch No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.batch_no.$wrapper, this, grid_row);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype('Journal Entry', () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc('Journal Entry');\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\" ;\n\t\t\t});\n\t\t\tfrappe.set_route('Form','Journal Entry', journal_entry.name);\n\t\t});\n\t}\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.removeClass('hidden');\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tadd_dimensions: function(report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\tcallback: function(r) {\n\t\t\t\tlet accounting_dimensions = r.message[0];\n\t\t\t\taccounting_dimensions.forEach((dimension) => {\n\t\t\t\t\tlet found = filters.some(el => el.fieldname === dimension['fieldname']);\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\"fieldname\": dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\"label\": __(dimension[\"label\"]),\n\t\t\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\t\t\"options\": dimension[\"document_type\"]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\toverrides_parent_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tif (doc[parent_fieldname]) {\n\t\t\tlet cl = doc[table_fieldname] || [];\n\t\t\tfor (let i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t\tfrappe.refresh_field(table_fieldname);\n\t\t}\n\t},\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t}\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrm.script_manager.trigger(item_field, row.doctype, row.name)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name,\n\t\t\t\t\t\t\topts.original_item_field, d.item_code);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find(f => f.fieldname == fieldname).precision;\n\n\tthis.data = [];\n\tconst fields = [{\n\t\tfieldtype:'Data',\n\t\tfieldname:\"docname\",\n\t\tread_only: 1,\n\t\thidden: 1,\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:\"item_code\",\n\t\toptions: 'Item',\n\t\tin_list_view: 1,\n\t\tread_only: 0,\n\t\tdisabled: 0,\n\t\tlabel: __('Item Code')\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:'uom',\n\t\toptions: 'UOM',\n\t\tread_only: 0,\n\t\tlabel: __('UOM'),\n\t\treqd: 1,\n\t\tonchange: function () {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\tcallback: r => {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some(doc => {\n\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tfieldtype:'Float',\n\t\tfieldname:\"qty\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Qty'),\n\t\tprecision: get_precision(\"qty\")\n\t}, {\n\t\tfieldtype:'Currency',\n\t\tfieldname:\"rate\",\n\t\toptions: \"currency\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Rate'),\n\t\tprecision: get_precision(\"rate\")\n\t}];\n\n\tif (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order' ) {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: 'Date',\n\t\t\tfieldname: frm.doc.doctype == 'Sales Order' ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == 'Sales Order' ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1\n\t\t})\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: 'Float',\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision('conversion_factor')\n\t\t})\n\t}\n\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"];\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"name\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t\t\"uom\": d.uom\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tfunction _map() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t\"args\": opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => query_args;\n\t}\n\n\tif (opts.source_doctype) {\n\t\tconst d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif(values.length === 0){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\topts.setters = args;\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tif (opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif (doc && value && doc.item_name && doc.item_name !== value && doc.item_code === value) {\n\t\treturn value + ': ' + doc.item_name;\n\t} else if (!value && doc.doctype && doc.item_name) {\n\t\t// format blank value in child table\n\t\treturn doc.item_name;\n\t} else {\n\t\t// if value is blank in report view or item code and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif(doc && doc.employee_name && doc.employee_name !== value) {\n\t\treturn value? value + ': ' + doc.employee_name: doc.employee_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Project'] = function(value, doc) {\n\tif (doc && value && doc.project_name && doc.project_name !== value && doc.project === value) {\n\t\treturn value + ': ' + doc.project_name;\n\t} else if (!value && doc.doctype && doc.project_name) {\n\t\t// format blank value in child table\n\t\treturn doc.project;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n\tlet $btn_div = $(\"<div>\").css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t.appendTo(append_loction);\n\tlet $btn = $(`<button class=\"btn btn-sm btn-default\">${inner_text}</button>`)\n\t\t.appendTo($btn_div);\n\n\t$btn.on(\"click\", function() {\n\t\tcontext.show_serial_batch_selector(grid_row.frm, grid_row.doc, \"\", \"\", true);\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'ERPNext Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'Shopping Cart': 'Website',\n\t'Contacts': 'CRM'\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function(doc, child_fields, dimension, company) {\n\t\tlet account = '';\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"erpnext.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\t'dimension': dimension,\n\t\t\t\t'account': account,\n\t\t\t\t'company': company\n\t\t\t}\n\t\t};\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (args) {\n\t\tif (in_list(['Sales Invoice', 'Sales Order', 'Delivery Note'], frm.doc.doctype)) {\n\t\t\tif (frm.doc.company_address && (!args.company_address)) {\n\t\t\t\targs.company_address = frm.doc.company_address;\n\t\t\t}\n\t\t}\n\n\t\tif (in_list(['Purchase Invoice', 'Purchase Order', 'Purchase Receipt'], frm.doc.doctype)) {\n\t\t\tif (frm.doc.shipping_address && (!args.shipping_address)) {\n\t\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!args) {\n\t\tif ((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && frm.doc.quotation_to === \"Lead\") {\n\t\t\t\tparty_type = \"Lead\";\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (in_list(['Sales Invoice', 'Sales Order', 'Delivery Note'], frm.doc.doctype)) {\n\t\t\tif (!args) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: 'Customer'\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (frm.doc.company_address && (!args.company_address)) {\n\t\t\t\targs.company_address = frm.doc.company_address;\n\t\t\t}\n\n\t\t\tif (frm.doc.shipping_address_name &&(!args.shipping_address_name)) {\n\t\t\t\targs.shipping_address_name = frm.doc.shipping_address_name;\n\t\t\t}\n\t\t}\n\n\t\tif (in_list(['Purchase Invoice', 'Purchase Order', 'Purchase Receipt'], frm.doc.doctype)) {\n\t\t\tif (!args) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: 'Supplier'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (frm.doc.shipping_address && (!args.shipping_address)) {\n\t\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t\t}\n\t\t}\n\n\t\tif (args) {\n\t\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\t}\n\t}\n\tif (!args || !args.party) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc){\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.set_taxes = function(frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.get_contact_details = function(frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: {contact: frm.doc.contact_person },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message)\n\t\t\t\t\tfrm.set_value(r.message);\n\t\t\t}\n\t\t})\n\t}\n}\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({message:__(\"Please enter {0} first\", [label]), title:__(\"Mandatory\")});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback){\n\tif (frm.doc.company) {\n\t\tif (!(frm.doc.inter_com_order_reference || frm.doc.internal_invoice_reference ||\n\t\t\tfrm.doc.internal_order_reference)) {\n\t\t\tif (callback) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif (r.message){\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\t\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text()\n\t},\n\n\tselect_text: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\t$(this).select();\n\t\t})\n\t},\n\n\tset_payment_primary_action: function(){\n\t\tvar me = this;\n\t\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t},\n\n\tmake_multimode_payment: function(){\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.change_amount > 0){\n\t\t\tme.payment_val = me.doc.outstanding_amount\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif(this.frm.doc.payments.length){\n\t\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row()\n\t\tthis.payment_val = 0.0\n\t\tif(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount()\n\t\t}else if(flt(this.selected_mode.val()) > 0){\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\t\n\tbind_keyboard_event: function(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t})\n\t\t\n\t\t$(this.$body).find('.write_off_amount').change(function(){\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t})\n\t\t\n\t\t$(this.$body).find('.change_amount').change(function(){\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t})\n\t},\n\n\thighlight_selected_row: function(){\n\t\tvar me = this;\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\",{'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode')\n\t\tselected_row.addClass('selected-payment-mode')\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\t\n\tbind_numeric_keys_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.delete-btn').click(function(){\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\t\n\tbind_amount_change_event: function(){\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function(){\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_payment_amount()\n\t\t})\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e){\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t})\n\t},\n\n\twrite_off_amount: function(write_off_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false)\n\t\tthis.show_amounts()\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount()\n\t\tthis.show_amounts()\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif(in_list(['change_amount', 'write_off_amount'], this.idx)){\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif(me.idx == 'change_amount'){\n\t\t\t\tme.change_amount(value)\n\t\t\t} else{\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value)\n\t\t\t}\n\t\t}else{\n\t\t\tthis.update_payment_amount()\n\t\t}\n\t},\n\n\tupdate_payment_amount: function(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\tif(cint(me.idx) == cint(data.idx)){\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2)\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency))\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency))\n\t\tthis.update_invoice();\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {\n\t\tthis.fetch_round_off_accounts();\n\t},\n\n\tapply_pricing_rule_on_item: function(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif (in_list([\"Sales Order\", \"Quotation\"], item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif(item.margin_type == \"Percentage\"){\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif(item.discount_percentage){\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t},\n\n\tcalculate_taxes_and_totals: function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_pos &&\n\t\t\tthis.frm.doc.is_return) {\n\t\t\tthis.update_paid_amount_for_return();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif(this.frm.doc.doctype === \"Purchase Invoice\" && this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function(){\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\n\t\t\t\tif ((!item.qty) && me.frm.doc.is_return) {\n\t\t\t\t\titem.amount = flt(item.rate * -1, precision(\"amount\", item));\n\t\t\t\t} else {\n\t\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\ttax.item_wise_tax_detail = {};\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tfetch_round_off_accounts: function() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\treturn frappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\tme.round_off_base_values(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tround_off_base_values: function(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t},\n\n\tis_internal_invoice: function() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tupdate_paid_amount_for_return: function() {\n\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\tthis.frm.doc.payments.find(pay => {\n\t\t\tif (pay.default) {\n\t\t\t\tpay.amount = total_amount_to_pay;\n\t\t\t} else {\n\t\t\t\tpay.amount = 0.0\n\t\t\t}\n\t\t});\n\t\tthis.frm.refresh_fields();\n\n\t\tthis.calculate_paid_amount();\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tlet amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t},\n\n\tcalculate_change_amount: function(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total +\n\t\t\t\t\tthis.frm.doc.write_off_amount, precision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total + this.frm.doc.base_write_off_amount,\n\t\t\t\t\tprecision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function(){\n\t\tif(this.frm.doc.paid_amount > this.frm.doc.grand_total){\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.grand_total - this.frm.doc.paid_amount\n\t\t\t\t+ this.frm.doc.change_amount, precision(\"write_off_amount\"));\n\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\t\t}else{\n\t\t\tthis.frm.doc.paid_amount = 0.0;\n\t\t}\n\t\tthis.calculate_outstanding_amount(false);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\r\n// License: GNU General Public License v3. See license.txt\r\n\r\nfrappe.provide('erpnext.accounts.dimensions');\r\n\r\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\r\n\tsetup: function() {\r\n\t\tthis._super();\r\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\r\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\r\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\r\n\r\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\r\n\r\n\t\t\tif(item.price_list_rate) {\r\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\r\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\r\n\t\t\t\t\t// or set discount\r\n\t\t\t\t\titem.discount_percentage = 0;\r\n\t\t\t\t\titem.margin_type = 'Amount';\r\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\r\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\r\n\t\t\t\t\titem.rate_with_margin = item.rate;\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\r\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\r\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\r\n\t\t\t\t\titem.margin_type = '';\r\n\t\t\t\t\titem.margin_rate_or_amount = 0;\r\n\t\t\t\t\titem.rate_with_margin = 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\titem.discount_percentage = 0.0;\r\n\t\t\t\titem.margin_type = '';\r\n\t\t\t\titem.margin_rate_or_amount = 0;\r\n\t\t\t\titem.rate_with_margin = 0;\r\n\t\t\t}\r\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\r\n\r\n\t\t\tcur_frm.cscript.set_gross_profit(item);\r\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t\tcur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\r\n\t\t});\r\n\r\n\r\n\r\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\r\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\r\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\r\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\r\n\t\t\tcur_frm.cscript.set_dynamic_labels();\r\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\r\n\t\t\tif(frm.doc.additional_discount_percentage) {\r\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\r\n\t\t\t} else {\r\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\r\n\t\t\tif(!frm.doc.apply_discount_on) {\r\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfrm.via_discount_percentage = true;\r\n\r\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\r\n\t\t\t\t// Reset discount amount and net / grand total\r\n\t\t\t\tfrm.doc.discount_amount = 0;\r\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\r\n\t\t\t}\r\n\r\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\r\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\r\n\t\t\t\tprecision(\"discount_amount\"));\r\n\r\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\r\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\r\n\t\t\tfrm.cscript.set_dynamic_labels();\r\n\r\n\t\t\tif (!frm.via_discount_percentage) {\r\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\r\n\t\t\t}\r\n\r\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\r\n\t\t});\r\n\r\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\r\n\t\t\titems_add: function(frm, cdt, cdn) {\r\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\t\t\tif (!item.warehouse && frm.doc.set_warehouse) {\r\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!item.target_warehouse && frm.doc.set_target_warehouse) {\r\n\t\t\t\t\titem.target_warehouse = frm.doc.set_target_warehouse;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!item.from_warehouse && frm.doc.set_from_warehouse) {\r\n\t\t\t\t\titem.from_warehouse = frm.doc.set_from_warehouse;\r\n\t\t\t\t}\r\n\r\n\t\t\t\terpnext.accounts.dimensions.copy_dimension_from_first_row(frm, cdt, cdn, 'items');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar me = this;\r\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\r\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\r\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(\r\n\t\t\tthis.frm.docstatus < 2\r\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\r\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\r\n\t\t\t&& this.frm.doc.payment_terms_template\r\n\t\t\t&& !this.frm.doc.payment_schedule.length\r\n\t\t){\r\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\r\n\t\t}\r\n\r\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\r\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\r\n\t\t}\r\n\r\n\t\tif(this.frm.fields_dict[\"items\"]) {\r\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\r\n\t\t}\r\n\r\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\r\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\r\n\t\t\t\treturn{\r\n\t\t\t\t\tfilters: [\r\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\r\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\r\n\t\t\t\tvar filters = {\r\n\t\t\t\t\t\"docstatus\": 1,\r\n\t\t\t\t\t\"is_return\": 0,\r\n\t\t\t\t\t\"company\": doc.company\r\n\t\t\t\t};\r\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\r\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfilters: filters\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\r\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfilters: {\r\n\t\t\t\t\t\t\"company\": doc.company\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\r\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\r\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet batch_no_field = this.frm.get_docfield(\"items\", \"batch_no\");\r\n\t\tif (batch_no_field) {\r\n\t\t\tbatch_no_field.get_route_options_for_new_doc = function(row) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"item\": row.doc.item_code\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\r\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\r\n\t\t\t\tvar item = locals[cdt][cdn];\r\n\t\t\t\treturn {\r\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\r\n\t\t\t\t\tfilters: {\r\n\t\t\t\t\t\t\"company\": doc.company,\r\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\r\n\t\t\t\t\t\t\"item\": item.item_code\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.frm.fields_dict.taxes_and_charges) {\r\n\t\t\tthis.frm.set_query(\"taxes_and_charges\", function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfilters: [\r\n\t\t\t\t\t\t['company', '=', me.frm.doc.company],\r\n\t\t\t\t\t\t['docstatus', '!=', 2]\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t},\r\n\tonload: function() {\r\n\t\tvar me = this;\r\n\r\n\t\tif(this.frm.doc.__islocal) {\r\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\r\n\r\n\t\t\tlet set_value = (fieldname, value) => {\r\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\r\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.frm.trigger('set_default_internal_warehouse');\r\n\r\n\t\t\treturn frappe.run_serially([\r\n\t\t\t\t() => set_value('currency', currency),\r\n\t\t\t\t() => set_value('price_list_currency', currency),\r\n\t\t\t\t() => set_value('status', 'Draft'),\r\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\r\n\t\t\t\t() => {\r\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\r\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]);\r\n\t\t}\r\n\t},\r\n\r\n\tis_return: function() {\r\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\r\n\t\t\tthis.frm.set_value('return_against', '');\r\n\t\t}\r\n\t},\r\n\r\n\tsetup_quality_inspection: function() {\r\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar me = this;\r\n\t\tvar inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\r\n\t\t\t? \"Incoming\" : \"Outgoing\";\r\n\r\n\t\tvar quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\r\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\r\n\t\t\tif(me.frm.is_new()) return;\r\n\t\t\treturn {\r\n\t\t\t\t\"inspection_type\": inspection_type,\r\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\r\n\t\t\t\t\"reference_name\": me.frm.doc.name,\r\n\t\t\t\t\"item_code\": row.doc.item_code,\r\n\t\t\t\t\"description\": row.doc.description,\r\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\r\n\t\t\t\t\"batch_no\": row.doc.batch_no\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\r\n\t\t\tvar d = locals[cdt][cdn];\r\n\t\t\treturn {\r\n\t\t\t\tfilters: {\r\n\t\t\t\t\tdocstatus: 1,\r\n\t\t\t\t\tinspection_type: inspection_type,\r\n\t\t\t\t\treference_name: doc.name,\r\n\t\t\t\t\titem_code: d.item_code\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tmake_payment_request: function() {\r\n\t\tvar me = this;\r\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\r\n\t\t\t? \"Inward\" : \"Outward\";\r\n\r\n\t\tfrappe.call({\r\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\r\n\t\t\targs: {\r\n\t\t\t\tdt: me.frm.doc.doctype,\r\n\t\t\t\tdn: me.frm.doc.name,\r\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\r\n\t\t\t\tpayment_request_type: payment_request_type,\r\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\r\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\r\n\t\t\t},\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tif(!r.exc){\r\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\r\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\r\n\tonload_post_render: function() {\r\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\r\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\r\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\r\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\r\n\t\t\t&& !this.frm.doc.is_pos) {\r\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\r\n\t\t}\r\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\r\n\t\t\tthis.setup_item_selector();\r\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\r\n\t\t}\r\n\t},\r\n\r\n\trefresh: function() {\r\n\t\terpnext.toggle_naming_series();\r\n\t\terpnext.hide_company();\r\n\t\tthis.set_dynamic_labels();\r\n\t\tthis.setup_sms();\r\n\t\tthis.setup_quality_inspection();\r\n\t\tlet scan_barcode_field = this.frm.get_field('scan_barcode');\r\n\t\tif (scan_barcode_field && scan_barcode_field.get_value()) {\r\n\t\t\tscan_barcode_field.set_value(\"\");\r\n\t\t\tscan_barcode_field.set_new_description(\"\");\r\n\r\n\t\t\tif (frappe.is_mobile()) {\r\n\t\t\t\tif (scan_barcode_field.$input_wrapper.find('.input-group').length) return;\r\n\r\n\t\t\t\tlet $input_group = $('<div class=\"input-group\">');\r\n\t\t\t\tscan_barcode_field.$input_wrapper.find('.control-input').append($input_group);\r\n\t\t\t\t$input_group.append(scan_barcode_field.$input);\r\n\t\t\t\t$(`<span class=\"input-group-btn\" style=\"vertical-align: top\">\r\n\t\t\t\t\t\t<button class=\"btn btn-default border\" type=\"button\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-camera text-muted\"></i>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</span>`)\r\n\t\t\t\t\t.on('click', '.btn', () => {\r\n\t\t\t\t\t\tfrappe.barcode.scan_barcode().then(barcode => {\r\n\t\t\t\t\t\t\tscan_barcode_field.set_value(barcode);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.appendTo($input_group);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tscan_barcode: function() {\r\n\t\tlet scan_barcode_field = this.frm.fields_dict[\"scan_barcode\"];\r\n\r\n\t\tlet show_description = function(idx, exist = null) {\r\n\t\t\tif (exist) {\r\n\t\t\t\tfrappe.show_alert({\r\n\t\t\t\t\tmessage: __('Row #{0}: Qty increased by 1', [idx]),\r\n\t\t\t\t\tindicator: 'green'\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfrappe.show_alert({\r\n\t\t\t\t\tmessage: __('Row #{0}: Item added', [idx]),\r\n\t\t\t\t\tindicator: 'green'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this.frm.doc.scan_barcode) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_serial_or_batch_or_barcode_number\",\r\n\t\t\t\targs: { search_value: this.frm.doc.scan_barcode }\r\n\t\t\t}).then(r => {\r\n\t\t\t\tconst data = r && r.message;\r\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\r\n\t\t\t\t\tfrappe.show_alert({\r\n\t\t\t\t\t\tmessage: __('Cannot find Item with this Barcode'),\r\n\t\t\t\t\t\tindicator: 'red'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet cur_grid = this.frm.fields_dict.items.grid;\r\n\r\n\t\t\t\tlet row_to_modify = null;\r\n\t\t\t\tconst existing_item_row = this.frm.doc.items.find(d => d.item_code === data.item_code);\r\n\t\t\t\tconst blank_item_row = this.frm.doc.items.find(d => !d.item_code);\r\n\r\n\t\t\t\tif (existing_item_row) {\r\n\t\t\t\t\trow_to_modify = existing_item_row;\r\n\t\t\t\t} else if (blank_item_row) {\r\n\t\t\t\t\trow_to_modify = blank_item_row;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!row_to_modify) {\r\n\t\t\t\t\t// add new row\r\n\t\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc, cur_grid.doctype, 'items');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tshow_description(row_to_modify.idx, row_to_modify.item_code);\r\n\r\n\t\t\t\tthis.frm.from_barcode = this.frm.from_barcode ? this.frm.from_barcode + 1 : 1;\r\n\t\t\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, {\r\n\t\t\t\t\titem_code: data.item_code,\r\n\t\t\t\t\tqty: (row_to_modify.qty || 0) + 1\r\n\t\t\t\t});\r\n\r\n\t\t\t\t['serial_no', 'batch_no', 'barcode'].forEach(field => {\r\n\t\t\t\t\tif (data[field] && frappe.meta.has_field(row_to_modify.doctype, field)) {\r\n\r\n\t\t\t\t\t\tlet value = (row_to_modify[field] && field === \"serial_no\")\r\n\t\t\t\t\t\t\t? row_to_modify[field] + '\\n' + data[field] : data[field];\r\n\r\n\t\t\t\t\t\tfrappe.model.set_value(row_to_modify.doctype,\r\n\t\t\t\t\t\t\trow_to_modify.name, field, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tscan_barcode_field.set_value('');\r\n\t\t\t\trefresh_field(\"items\");\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tapply_default_taxes: function() {\r\n\t\tvar me = this;\r\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\r\n\t\t\tme.frm.doc.name);\r\n\r\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (taxes_and_charges_field) {\r\n\t\t\treturn frappe.call({\r\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\r\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\r\n\t\t\t\t\t\"company\": me.frm.doc.company\r\n\t\t\t\t},\r\n\t\t\t\tdebounce: 2000,\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc && r.message) {\r\n\t\t\t\t\t\tfrappe.run_serially([\r\n\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\r\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\r\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// set taxes table\r\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\r\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\r\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\r\n\t\t\t\t\t\t]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tsetup_sms: function() {\r\n\t\tvar me = this;\r\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\r\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\r\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\r\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\r\n\t\t}\r\n\t},\r\n\r\n\tsend_sms: function() {\r\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\r\n\t},\r\n\r\n\tbarcode: function(doc, cdt, cdn) {\r\n\t\tvar d = locals[cdt][cdn];\r\n\t\tif(d.barcode==\"\" || d.barcode==null) {\r\n\t\t\t// barcode cleared, remove item\r\n\t\t\td.item_code = \"\";\r\n\t\t}\r\n\r\n\t\tthis.frm.from_barcode = this.frm.from_barcode ? this.frm.from_barcode + 1 : 1;\r\n\t\tthis.item_code(doc, cdt, cdn);\r\n\t},\r\n\r\n\titem_code: function(doc, cdt, cdn) {\r\n\t\tvar me = this;\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\tvar update_stock = 0, show_batch_dialog = 0;\r\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\r\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\r\n\t\t\tshow_batch_dialog = update_stock;\r\n\r\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\r\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\r\n\t\t\tshow_batch_dialog = 1;\r\n\t\t}\r\n\t\t// clear barcode if setting item (else barcode will take priority)\r\n\t\tif (this.frm.from_barcode == 0) {\r\n\t\t\titem.barcode = null;\r\n\t\t}\r\n\t\tthis.frm.from_barcode = this.frm.from_barcode - 1 >= 0 ? this.frm.from_barcode - 1 : 0;\r\n\r\n\r\n\t\tif(item.item_code || item.barcode || item.serial_no) {\r\n\t\t\tif(!this.validate_company_and_party()) {\r\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\r\n\t\t\t} else {\r\n\t\t\t\treturn this.frm.call({\r\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\r\n\t\t\t\t\tchild: item,\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\tdoc: me.frm.doc,\r\n\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\titem_code: item.item_code,\r\n\t\t\t\t\t\t\tbarcode: item.barcode,\r\n\t\t\t\t\t\t\tserial_no: item.serial_no,\r\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\r\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\r\n\t\t\t\t\t\t\twarehouse: item.warehouse,\r\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\r\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\r\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\r\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\r\n\t\t\t\t\t\t\tupdate_stock: update_stock,\r\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\r\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\r\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\r\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\r\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\r\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\r\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\r\n\t\t\t\t\t\t\tis_return: cint(me.frm.doc.is_return),\r\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\r\n\t\t\t\t\t\t\ttransaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\r\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\r\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\r\n\t\t\t\t\t\t\tname: me.frm.doc.name,\r\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\r\n\t\t\t\t\t\t\tqty: item.qty || 1,\r\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\r\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\r\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\r\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\r\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\r\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\r\n\t\t\t\t\t\t\tpos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\r\n\t\t\t\t\t\t\tcost_center: item.cost_center,\r\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\r\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\r\n\t\t\t\t\t\t\tchild_docname: item.name\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\t\tfrappe.run_serially([\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\r\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\r\n\t\t\t\t\t\t\t\t\tif (d.free_item_data) {\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\r\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\r\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\r\n\t\t\t\t\t\t\t\t\t\t\tme.frm.doc.doctype, me.frm.doc.company);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\r\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog)\r\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\r\n\t\t\t\t\t\t\t\t\t\t\t.then((r) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t(r.message.has_batch_no || r.message.has_serial_no)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\t// check if batch serial selector is disabled or not\r\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\r\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\r\n\t\t\t\t\t\t\t\t\t\t\t.then((value) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\r\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\r\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\r\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\r\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\r\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\r\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\r\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\r\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\r\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\r\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\tvar company_currency = me.get_company_currency();\r\n\t\t\t\t\t\t\t\t\tme.update_item_grid_labels(company_currency);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tprice_list_rate: function(doc, cdt, cdn) {\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\tfrappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\r\n\r\n\t\t// check if child doctype is Sales Order Item/Qutation Item and calculate the rate\r\n\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), cdt)\r\n\t\t\tthis.apply_pricing_rule_on_item(item);\r\n\t\telse\r\n\t\t\titem.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\r\n\t\t\t\tprecision(\"rate\", item));\r\n\r\n\t\tthis.calculate_taxes_and_totals();\r\n\t},\r\n\r\n\tmargin_rate_or_amount: function(doc, cdt, cdn) {\r\n\t\t// calculated the revised total margin and rate on margin rate changes\r\n\t\tlet item = frappe.get_doc(cdt, cdn);\r\n\t\tthis.apply_pricing_rule_on_item(item);\r\n\t\tthis.calculate_taxes_and_totals();\r\n\t\tcur_frm.refresh_fields();\r\n\t},\r\n\r\n\tmargin_type: function(doc, cdt, cdn) {\r\n\t\t// calculate the revised total margin and rate on margin type changes\r\n\t\tlet item = frappe.get_doc(cdt, cdn);\r\n\t\tif (!item.margin_type) {\r\n\t\t\tfrappe.model.set_value(cdt, cdn, \"margin_rate_or_amount\", 0);\r\n\t\t} else {\r\n\t\t\tthis.apply_pricing_rule_on_item(item, doc, cdt, cdn);\r\n\t\t\tthis.calculate_taxes_and_totals();\r\n\t\t\tcur_frm.refresh_fields();\r\n\t\t}\r\n\t},\r\n\r\n\tget_incoming_rate: function(item, posting_date, posting_time, voucher_type, company) {\r\n\r\n\t\tlet item_args = {\r\n\t\t\t'item_code': item.item_code,\r\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\r\n\t\t\t'posting_date': posting_date,\r\n\t\t\t'posting_time': posting_time,\r\n\t\t\t'qty': item.qty * item.conversion_factor,\r\n\t\t\t'serial_no': item.serial_no,\r\n\t\t\t'voucher_type': voucher_type,\r\n\t\t\t'company': company,\r\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\r\n\t\t}\r\n\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\r\n\t\t\targs: {\r\n\t\t\t\targs: item_args\r\n\t\t\t},\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message * item.conversion_factor);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tadd_taxes_from_item_tax_template: function(item_tax_map) {\r\n\t\tlet me = this;\r\n\r\n\t\tif(item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\r\n\t\t\tif(typeof (item_tax_map) == \"string\") {\r\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\r\n\t\t\t}\r\n\r\n\t\t\t$.each(item_tax_map, function(tax, rate) {\r\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\r\n\t\t\t\tif(!found) {\r\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\r\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\r\n\t\t\t\t\tchild.account_head = tax;\r\n\t\t\t\t\tchild.rate = 0;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tserial_no: function(doc, cdt, cdn) {\r\n\t\tvar me = this;\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\r\n\t\tif (item && item.serial_no) {\r\n\t\t\tif (!item.item_code) {\r\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Replacing all occurences of comma with carriage return\r\n\t\t\t\titem.serial_no = item.serial_no.replace(/,/g, '\\n');\r\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\r\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\r\n\t\t\t\tif (!doc.is_return && cint(frappe.user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tme.update_qty(cdt, cdn);\r\n\t\t\t\t\t}, 10000);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tupdate_qty: function(cdt, cdn) {\r\n\t\tvar valid_serial_nos = [];\r\n\t\tvar serialnos = [];\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\tserialnos = item.serial_no.split(\"\\n\");\r\n\t\tfor (var i = 0; i < serialnos.length; i++) {\r\n\t\t\tif (serialnos[i] != \"\") {\r\n\t\t\t\tvalid_serial_nos.push(serialnos[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfrappe.model.set_value(item.doctype, item.name,\r\n\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\r\n\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\r\n\t},\r\n\r\n\tvalidate: function() {\r\n\t\tthis.calculate_taxes_and_totals(false);\r\n\t},\r\n\r\n\tupdate_stock: function() {\r\n\t\tthis.frm.trigger('set_default_internal_warehouse');\r\n\t},\r\n\r\n\tset_default_internal_warehouse: function() {\r\n\t\tlet me = this;\r\n\t\tif ((this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock)\r\n\t\t\t|| this.frm.doc.doctype == 'Delivery Note') {\r\n\t\t\tif (this.frm.doc.is_internal_customer && this.frm.doc.company === this.frm.doc.represents_company) {\r\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\r\n\t\t\t\t\tme.frm.set_value('set_target_warehouse', value.default_in_transit_warehouse);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((this.frm.doc.doctype === 'Purchase Invoice' && me.frm.doc.update_stock)\r\n\t\t\t|| this.frm.doc.doctype == 'Purchase Receipt') {\r\n\t\t\tif (this.frm.doc.is_internal_supplier && this.frm.doc.company === this.frm.doc.represents_company) {\r\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\r\n\t\t\t\t\tme.frm.set_value('set_from_warehouse', value.default_in_transit_warehouse);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcompany: function() {\r\n\t\tvar me = this;\r\n\t\tvar set_pricing = function() {\r\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\r\n\t\t\t\tvar company_currency = me.get_company_currency();\r\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\r\n\r\n\t\t\t\tif (!me.frm.doc.currency) {\r\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\r\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\r\n\t\t\t\t}\r\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\r\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\r\n\t\t\t\t}\r\n\t\t\t\tif (company_doc.default_letter_head) {\r\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\r\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\r\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\r\n\t\t\t\tselling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\r\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\r\n\t\t\t\t}\r\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\r\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\r\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\r\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\r\n\t\t\t\tbuying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\r\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfrappe.run_serially([\r\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\r\n\t\t\t\t\t() => me.update_item_tax_map(),\r\n\t\t\t\t\t() => me.apply_default_taxes(),\r\n\t\t\t\t\t() => me.apply_pricing_rule()\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar set_party_account = function(set_pricing) {\r\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\r\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\r\n\t\t\t\t\tvar party_type = \"Customer\";\r\n\t\t\t\t\tvar party_account_field = 'debit_to';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar party_type = \"Supplier\";\r\n\t\t\t\t\tvar party_account_field = 'credit_to';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\r\n\t\t\t\tif(party && me.frm.doc.company) {\r\n\t\t\t\t\treturn frappe.call({\r\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\r\n\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\r\n\t\t\t\t\t\t\tparty_type: party_type,\r\n\t\t\t\t\t\t\tparty: party\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\r\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\r\n\t\t\t\t\t\t\t\tset_pricing();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tset_pricing();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tset_pricing();\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this.frm.doc.posting_date) var date = this.frm.doc.posting_date;\r\n\t\telse var date = this.frm.doc.transaction_date;\r\n\r\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\r\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)) {\r\n\t\t\terpnext.utils.get_shipping_address(this.frm, function(){\r\n\t\t\t\tset_party_account(set_pricing);\r\n\t\t\t});\r\n\r\n\t\t\t// Get default company billing address in Purchase Invoice, Order and Receipt\r\n\t\t\tfrappe.call({\r\n\t\t\t\t'method': 'frappe.contacts.doctype.address.address.get_default_address',\r\n\t\t\t\t'args': {\r\n\t\t\t\t\t'doctype': 'Company',\r\n\t\t\t\t\t'name': this.frm.doc.company\r\n\t\t\t\t},\r\n\t\t\t\t'callback': function(r) {\r\n\t\t\t\t\tme.frm.set_value('billing_address', r.message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t} else {\r\n\t\t\tset_party_account(set_pricing);\r\n\t\t}\r\n\r\n\t\tif(this.frm.doc.company) {\r\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\r\n\t\t}\r\n\t},\r\n\r\n\ttransaction_date: function() {\r\n\t\tif (this.frm.doc.transaction_date) {\r\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\r\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\r\n\t\t}\r\n\t},\r\n\r\n\tposting_date: function() {\r\n\t\tvar me = this;\r\n\t\tif (this.frm.doc.posting_date) {\r\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\r\n\r\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\r\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\r\n\t\t\t\treturn frappe.call({\r\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\r\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\r\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\r\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\r\n\t\t\t\t\t\t\"company\": me.frm.doc.company\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\t\tif(r.message) {\r\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\r\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\r\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\r\n\t\t\t\t\t\t\tme.recalculate_terms();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tdue_date: function() {\r\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\r\n\t\t// be removed as due_date is automatically changed based on payment terms\r\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\r\n\t\t\tif (this.frm.doc.payment_terms_template ||\r\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\r\n\t\t\t\tvar message1 = \"\";\r\n\t\t\t\tvar message2 = \"\";\r\n\t\t\t\tvar final_message = \"Please clear the \";\r\n\r\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\r\n\t\t\t\t\tmessage1 = \"selected Payment Terms Template\";\r\n\t\t\t\t\tfinal_message = final_message + message1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\r\n\t\t\t\t\tmessage2 = \"Payment Schedule Table\";\r\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\r\n\t\t\t\t\tfinal_message = final_message + message2;\r\n\t\t\t\t}\r\n\t\t\t\tfrappe.msgprint(final_message);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tbill_date: function() {\r\n\t\tthis.posting_date();\r\n\t},\r\n\r\n\trecalculate_terms: function() {\r\n\t\tconst doc = this.frm.doc;\r\n\t\tif (doc.payment_terms_template) {\r\n\t\t\tthis.payment_terms_template();\r\n\t\t} else if (doc.payment_schedule) {\r\n\t\t\tconst me = this;\r\n\t\t\tdoc.payment_schedule.forEach(\r\n\t\t\t\tfunction(term) {\r\n\t\t\t\t\tif (term.payment_term) {\r\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfrappe.model.set_value(\r\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\r\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\tget_company_currency: function() {\r\n\t\treturn erpnext.get_currency(this.frm.doc.company);\r\n\t},\r\n\r\n\tcontact_person: function() {\r\n\t\terpnext.utils.get_contact_details(this.frm);\r\n\t},\r\n\r\n\tcurrency: function() {\r\n\t\t/* manqala 19/09/2016: let the translation date be whichever of the transaction_date or posting_date is available */\r\n\t\tvar transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\r\n\t\t/* end manqala */\r\n\t\tvar me = this;\r\n\t\tthis.set_dynamic_labels();\r\n\t\tvar company_currency = this.get_company_currency();\r\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\r\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\r\n\t\t\t\t&& !this.frm.doc.ignore_pricing_rule) {\r\n\r\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\r\n\t\t\t\tfunction(exchange_rate) {\r\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\r\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\r\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\r\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.conversion_rate();\r\n\t\t}\r\n\t},\r\n\r\n\tconversion_rate: function() {\r\n\t\tconst me = this.frm;\r\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\r\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\r\n\t\t}\r\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\r\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\r\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\r\n\t\t}\r\n\r\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\r\n\t\t\tif(this.frm.doc.ignore_pricing_rule) {\r\n\t\t\t\tthis.calculate_taxes_and_totals();\r\n\t\t\t} else if (!this.in_apply_price_list){\r\n\t\t\t\tthis.apply_price_list();\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\r\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\r\n\t},\r\n\r\n\tshipping_rule: function() {\r\n\t\tvar me = this;\r\n\t\tif(this.frm.doc.shipping_rule) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tdoc: this.frm.doc,\r\n\t\t\t\tmethod: \"apply_shipping_rule\",\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tme.calculate_taxes_and_totals();\r\n\t\t}\r\n\t},\r\n\r\n\tset_margin_amount_based_on_currency: function(exchange_rate) {\r\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Purchase Invoice\", \"Purchase Order\", \"Purchase Receipt\"]), this.frm.doc.doctype) {\r\n\t\t\tvar me = this;\r\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\r\n\t\t\t\tif(d.margin_type == \"Amount\") {\r\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\r\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tset_actual_charges_based_on_currency: function(exchange_rate) {\r\n\t\tvar me = this;\r\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\r\n\t\t\tif(d.charge_type == \"Actual\") {\r\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\r\n\t\t\t\t\tflt(d.tax_amount) / flt(exchange_rate));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\r\n\t\tvar args;\r\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\r\n\t\t\targs = \"for_selling\";\r\n\t\t}\r\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\r\n\t\t\targs = \"for_buying\";\r\n\t\t}\r\n\r\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\r\n\t\treturn frappe.call({\r\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\r\n\t\t\targs: {\r\n\t\t\t\ttransaction_date: transaction_date,\r\n\t\t\t\tfrom_currency: from_currency,\r\n\t\t\t\tto_currency: to_currency,\r\n\t\t\t\targs: args\r\n\t\t\t},\r\n\t\t\tfreeze: true,\r\n\t\t\tfreeze_message: __(\"Fetching exchange rates ...\"),\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tcallback(flt(r.message));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tprice_list_currency: function() {\r\n\t\tvar me=this;\r\n\t\tthis.set_dynamic_labels();\r\n\r\n\t\tvar company_currency = this.get_company_currency();\r\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\r\n\t\tif(this.frm.doc.price_list_currency !== company_currency  && !this.frm.doc.ignore_pricing_rule) {\r\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\r\n\t\t\t\tfunction(exchange_rate) {\r\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.plc_conversion_rate();\r\n\t\t}\r\n\t},\r\n\r\n\tplc_conversion_rate: function() {\r\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\r\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\r\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\r\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\r\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\r\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\r\n\t\t}\r\n\r\n\t\tif(!this.in_apply_price_list) {\r\n\t\t\tthis.apply_price_list(null, true);\r\n\t\t}\r\n\t},\r\n\r\n\tuom: function(doc, cdt, cdn) {\r\n\t\tvar me = this;\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\tif(item.item_code && item.uom) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\titem_code: item.item_code,\r\n\t\t\t\t\tuom: item.uom\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'conversion_factor', r.message.conversion_factor);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tme.calculate_stock_uom_rate(doc, cdt, cdn);\r\n\t},\r\n\r\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\r\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\r\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\r\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\r\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\r\n\t\t\tthis.toggle_conversion_factor(item);\r\n\r\n\t\t\tif(doc.doctype != \"Material Request\") {\r\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\r\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\r\n\t\t\t\tthis.calculate_net_weight();\r\n\t\t\t}\r\n\r\n\t\t\t// for handling customization not to fetch price list rate\r\n\t\t\tif(frappe.flags.dont_fetch_price_list_rate) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (!dont_fetch_price_list_rate &&\r\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\r\n\t\t\t\tthis.apply_price_list(item, true);\r\n\t\t\t}\r\n\t\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\r\n\t\t}\r\n\t},\r\n\r\n\tbatch_no: function(doc, cdt, cdn) {\r\n\t\tlet item = frappe.get_doc(cdt, cdn);\r\n\t\tthis.apply_price_list(item, true);\r\n\t},\r\n\r\n\ttoggle_conversion_factor: function(item) {\r\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\r\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\r\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\r\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tqty: function(doc, cdt, cdn) {\r\n\t\tlet item = frappe.get_doc(cdt, cdn);\r\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\r\n\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\r\n\t\t\r\n        this.apply_pricing_rule(item, true);\r\n\t},\r\n\r\n\tcalculate_stock_uom_rate: function(doc, cdt, cdn) {\r\n\t\tlet item = frappe.get_doc(cdt, cdn);\r\n\t\titem.stock_uom_rate = flt(item.rate)/flt(item.conversion_factor);\r\n\t\trefresh_field(\"stock_uom_rate\", item.name, item.parentfield);\r\n\t},\r\n\tservice_stop_date: function(frm, cdt, cdn) {\r\n\t\tvar child = locals[cdt][cdn];\r\n\r\n\t\tif(child.service_stop_date) {\r\n\t\t\tlet start_date = Date.parse(child.service_start_date);\r\n\t\t\tlet end_date = Date.parse(child.service_end_date);\r\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\r\n\r\n\t\t\tif(stop_date < start_date) {\r\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\r\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\r\n\t\t\t} else if (stop_date > end_date) {\r\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\r\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tservice_start_date: function(frm, cdt, cdn) {\r\n\t\tvar child = locals[cdt][cdn];\r\n\r\n\t\tif(child.service_start_date) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\r\n\t\t\t\targs: {\"args\": child},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tcalculate_net_weight: function(){\r\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\r\n\t\tvar me = this;\r\n\t\tthis.frm.doc.total_net_weight= 0.0;\r\n\r\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\r\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\r\n\t\t});\r\n\t\trefresh_field(\"total_net_weight\");\r\n\t\tthis.shipping_rule();\r\n\t},\r\n\r\n\tset_dynamic_labels: function() {\r\n\t\t// What TODO? should we make price list system non-mandatory?\r\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\r\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\r\n\r\n\t\tvar company_currency = this.get_company_currency();\r\n\t\tthis.change_form_labels(company_currency);\r\n\t\tthis.change_grid_labels(company_currency);\r\n\t\tthis.frm.refresh_fields();\r\n\t},\r\n\r\n\tchange_form_labels: function(company_currency) {\r\n\t\tvar me = this;\r\n\r\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\r\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\r\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\r\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\r\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\r\n\t\t\t\"base_rounding_adjustment\"], company_currency);\r\n\r\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\r\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\r\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\r\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\r\n\t\t\t\"total_cost\"], this.frm.doc.currency);\r\n\r\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\r\n\t\t\tthis.frm.doc.party_account_currency);\r\n\r\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\r\n\t\t\t+ \" = [?] \" + company_currency);\r\n\r\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\r\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\r\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\r\n\t\t}\r\n\r\n\t\t// toggle fields\r\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\r\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\r\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\r\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\r\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\r\n\t\tthis.frm.doc.currency != company_currency);\r\n\r\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\r\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\r\n\r\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\r\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\r\n\r\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\r\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\r\n\r\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\r\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\r\n\r\n\t},\r\n\r\n\tchange_grid_labels: function(company_currency) {\r\n\t\tvar me = this;\r\n\r\n\t\tthis.update_item_grid_labels(company_currency);\r\n\r\n\t\tthis.toggle_item_grid_columns(company_currency);\r\n\r\n\t\tif (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\r\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\r\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\r\n\r\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\r\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\r\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\r\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\r\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\r\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\r\n\r\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\r\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\r\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\r\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\r\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\r\n\r\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\r\n\t\t}\r\n\r\n\t\tif (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\r\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\r\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\r\n\t\t}\r\n\r\n\t\tthis.update_payment_schedule_grid_labels(company_currency);\r\n\t},\r\n\r\n\tupdate_item_grid_labels: function(company_currency) {\r\n\t\tthis.frm.set_currency_labels([\r\n\t\t\t\"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\r\n\t\t\t\"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\r\n\t\t], company_currency, \"items\");\r\n\r\n\t\tthis.frm.set_currency_labels([\r\n\t\t\t\"rate\", \"net_rate\", \"price_list_rate\", \"amount\",\r\n\t\t\t\"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\r\n\t\t], this.frm.doc.currency, \"items\");\r\n\t},\r\n\r\n\tupdate_payment_schedule_grid_labels: function(company_currency) {\r\n\t\tconst me = this;\r\n\t\tif (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length > 0) {\r\n\t\t\tthis.frm.set_currency_labels([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"],\r\n\t\t\t\tcompany_currency, \"payment_schedule\");\r\n\t\t\tthis.frm.set_currency_labels([\"payment_amount\", \"outstanding\", \"paid_amount\"],\r\n\t\t\t\tthis.frm.doc.currency, \"payment_schedule\");\r\n\r\n\t\t\tvar schedule_grid = this.frm.fields_dict[\"payment_schedule\"].grid;\r\n\t\t\t$.each([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"], function(i, fname) {\r\n\t\t\t\tif (frappe.meta.get_docfield(schedule_grid.doctype, fname))\r\n\t\t\t\t\tschedule_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\ttoggle_item_grid_columns: function(company_currency) {\r\n\t\tconst me = this;\r\n\t\t// toggle columns\r\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\r\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\r\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\r\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\r\n\t\t});\r\n\r\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\r\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\r\n\r\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\r\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\r\n\t\t\t\titem_grid.set_column_disp(fname, show);\r\n\t\t});\r\n\r\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\r\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\r\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\r\n\t\t});\r\n\t},\r\n\r\n\trecalculate: function() {\r\n\t\tthis.calculate_taxes_and_totals();\r\n\t},\r\n\r\n\trecalculate_values: function() {\r\n\t\tthis.calculate_taxes_and_totals();\r\n\t},\r\n\r\n\tcalculate_charges: function() {\r\n\t\tthis.calculate_taxes_and_totals();\r\n\t},\r\n\r\n\tignore_pricing_rule: function() {\r\n\t\t\r\n\t\tif(this.frm.doc.ignore_pricing_rule) {\r\n          \r\n\t\t\tvar me = this;\r\n\t\t\tvar item_list = [];\r\n\r\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\r\n\t\t\t\tif (d.item_code && !d.is_free_item) {\r\n\t\t\t\t\titem_list.push({\r\n\t\t\t\t\t\t\"doctype\": d.doctype,\r\n\t\t\t\t\t\t\"name\": d.name,\r\n\t\t\t\t\t\t\"item_code\": d.item_code,\r\n\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\r\n\t\t\t\t\t\t\"parenttype\": d.parenttype,\r\n\t\t\t\t\t\t\"parent\": d.parent\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\r\n\t\t\t\targs: { item_list: item_list },\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif (!r.exc && r.message) {\r\n\t\t\t\t\t\tr.message.forEach(row_item => {\r\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\r\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.apply_pricing_rule();\r\n\t\t}\r\n\t},\r\n\r\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\r\n\t\tvar me = this;\r\n\t\tvar args = this._get_args(item);\r\n\t\tif (!(args.items && args.items.length)) {\r\n\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\treturn this.frm.call({\r\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\r\n\t\t\targs: {\targs: args, doc: me.frm.doc },\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\t\r\n\t\t\t\tif (!r.exc && r.message) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tme._set_values_for_item_list(r.message,item);\r\n\t\t\t\t\tif(item) me.set_gross_profit(item);\r\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t_get_args: function(item) {\r\n\t\tvar me = this;\r\n\t\treturn {\r\n\t\t\t\"items\": this._get_item_list(item),\r\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\r\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\r\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\r\n\t\t\t\"territory\": me.frm.doc.territory,\r\n\t\t\t\"supplier\": me.frm.doc.supplier,\r\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\r\n\t\t\t\"currency\": me.frm.doc.currency,\r\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\r\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\r\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\r\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\r\n\t\t\t\"company\": me.frm.doc.company,\r\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\r\n\t\t\t\"campaign\": me.frm.doc.campaign,\r\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\r\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\r\n\t\t\t\"doctype\": me.frm.doc.doctype,\r\n\t\t\t\"name\": me.frm.doc.name,\r\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\r\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\r\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\r\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\r\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code\r\n\t\t};\r\n\t},\r\n\r\n\t_get_item_list: function(item) {\r\n\t\tvar item_list = [];\r\n\t\tvar append_item = function(d) {\r\n\t\t\tif (d.item_code) {\r\n\t\t\t\t\r\n\t\t\t\titem_list.push({\r\n\t\t\t\t\t\"doctype\": d.doctype,\r\n\t\t\t\t\t\"name\": d.name,\r\n\t\t\t\t\t\"child_docname\": d.name,\r\n\t\t\t\t\t\"item_code\": d.item_code,\r\n\t\t\t\t\t\"item_group\": d.item_group,\r\n\t\t\t\t\t\"brand\": d.brand,\r\n\t\t\t\t\t\"qty\": d.qty,\r\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\r\n\t\t\t\t\t\"uom\": d.uom,\r\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\r\n\t\t\t\t\t\"parenttype\": d.parenttype,\r\n\t\t\t\t\t\"parent\": d.parent,\r\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\r\n\t\t\t\t\t\"warehouse\": d.warehouse,\r\n\t\t\t\t\t\"serial_no\": d.serial_no,\r\n\t\t\t\t\t\"batch_no\": d.batch_no,\r\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\r\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\r\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\",  \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), d.doctype) {\r\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\r\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (item) {\r\n\t\t\tappend_item(item);\r\n\t\t} else {\r\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\r\n\t\t\t\tappend_item(d);\r\n\t\t\t});\r\n\t\t}\r\n        \r\n\t\treturn item_list;\r\n\t},\r\n\r\n\t_set_values_for_item_list: function(children,item=undefined) {\r\n\t\tvar me = this;\r\n\t\tvar price_list_rate_changed = false;\r\n\t\tvar items_rule_dict = {};\r\n        \r\n\t\tfor(var i=0, l=children.length; i<l; i++) {\r\n\t\t\tvar d = children[i];\r\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rules\");\r\n\t\t\t\r\n            for(var k in d) {\r\n\t\t\t\tvar v = d[k];\r\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\r\n\t\t\t\t\tif(k==\"price_list_rate\") {\r\n\t\t\t\t\t\tif(flt(v) != flt(d.price_list_rate)) price_list_rate_changed = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (k !== 'free_item_data') {\r\n                        \r\n\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, v);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\r\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rules) {\r\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\r\n\t\t\t} else if(!d.pricing_rules) {\r\n\t\t\t\tme.remove_pricing_rule(frappe.get_doc(d.doctype, d.name));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (d.free_item_data) {\r\n\t\t\t\t\r\n\t\t\t\tme.apply_product_discount(d,item);\r\n\t\t\t}\r\n\r\n\t\t\tif (d.apply_rule_on_other_items) {\r\n\t\t\t\titems_rule_dict[d.name] = d;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tme.apply_rule_on_other_items(items_rule_dict);\r\n\r\n\t\tif(!price_list_rate_changed) me.calculate_taxes_and_totals();\r\n\t},\r\n\r\n\tapply_rule_on_other_items: function(args) {\r\n\t\tconst me = this;\r\n\t\tconst fields = [\"discount_percentage\", \"pricing_rules\", \"discount_amount\", \"rate\"];\r\n\r\n\t\tfor(var k in args) {\r\n\t\t\tlet data = args[k];\r\n\r\n\t\t\tif (data && data.apply_rule_on_other_items) {\r\n\t\t\t\tme.frm.doc.items.forEach(d => {\r\n\t\t\t\t\tif (in_list(data.apply_rule_on_other_items, d[data.apply_rule_on])) {\r\n\t\t\t\t\t\tfor(var k in data) {\r\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'price' || k === 'pricing_rules')) {\r\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tapply_product_discount: function(args,item=undefined) {\r\n\t\tconst items = this.frm.doc.items.filter(d => (d.is_free_item)) || [];\r\n\t\t\r\n\t\tconst exist_items = items.map(row => (row.item_code, row.pricing_rules));\r\n\t\t\r\n\t\targs.free_item_data.forEach(pr_row => {\r\n\t\t\tlet row_to_modify = {};\r\n\t\t\tif (!items || !in_list(exist_items, (pr_row.item_code, pr_row.pricing_rules))) {\r\n\r\n\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc,\r\n\t\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\r\n\r\n\t\t\t} else if(items) {\r\n\t\t\t\trow_to_modify = items.filter(d => (d.item_code === pr_row.item_code\r\n\t\t\t\t\t&& d.pricing_rules === pr_row.pricing_rules))[0];\r\n\t\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\tfor (let key in pr_row) {\r\n\t\t\t\t\r\n\t\t\t\trow_to_modify[key] = pr_row[key];\r\n\t\t\t}\r\n\t\t\tif(item){\r\n\t\t\t\tconst hasKey = 'parent_item_row' in item;\r\n\t\t\t\tif (hasKey){\r\n\t\t\t\t\trow_to_modify[\"parent_item_row\"] = item.parent_item_row;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\t// free_item_data is a temporary variable\r\n\t\targs.free_item_data = '';\r\n\t\trefresh_field('items');\r\n\t},\r\n\r\n\tapply_price_list: function(item, reset_plc_conversion) {\r\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\r\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\r\n\t\tif (!reset_plc_conversion) {\r\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\r\n\t\t}\r\n\r\n\t\tvar me = this;\r\n\t\tvar args = this._get_args(item);\r\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (me.in_apply_price_list == true) return;\r\n\r\n\t\tme.in_apply_price_list = true;\r\n\t\treturn this.frm.call({\r\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\r\n\t\t\targs: {\targs: args },\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tif (!r.exc) {\r\n\t\t\t\t\tfrappe.run_serially([\r\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\r\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tif(args.items.length) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\r\n\t\t\t\t\t]);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tme.in_apply_price_list = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).always(() => {\r\n\t\t\tme.in_apply_price_list = false;\r\n\t\t});\r\n\t},\r\n\r\n\tremove_pricing_rule: function(item) {\r\n\t\tlet me = this;\r\n\t\tconst fields = [\"discount_percentage\",\r\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\r\n            //console.log(item,\"item\")\r\n        if(!item)\r\n        {\r\n            me.trigger_price_list_rate();\r\n        }\r\n        else{\r\n            if(item.remove_free_item) {\r\n                var items = [];\r\n    \r\n                me.frm.doc.items.forEach(d => {\r\n                    if(d.item_code != item.remove_free_item || !d.is_free_item) {\r\n                        items.push(d);\r\n                    }\r\n                });\r\n    \r\n                me.frm.doc.items = items;\r\n                refresh_field('items');\r\n            } else if(item.applied_on_items && item.apply_on) {\r\n                const applied_on_items = item.applied_on_items.split(',');\r\n                me.frm.doc.items.forEach(row => {\r\n                    if(applied_on_items.includes(row[item.apply_on])) {\r\n                        fields.forEach(f => {\r\n                            row[f] = 0;\r\n                        });\r\n    \r\n                        [\"pricing_rules\", \"margin_type\"].forEach(field => {\r\n                            if (row[field]) {\r\n                                row[field] = '';\r\n                            }\r\n                        })\r\n                    }\r\n                });\r\n    \r\n                me.trigger_price_list_rate();\r\n            }\r\n\r\n        }\r\n\t\t\r\n\t},\r\n\r\n\ttrigger_price_list_rate: function() {\r\n\t\tvar me  = this;\r\n\r\n\t\tthis.frm.doc.items.forEach(child_row => {\r\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\r\n\t\t\t\tchild_row.doctype, child_row.name);\r\n\t\t})\r\n\t},\r\n\r\n\tvalidate_company_and_party: function() {\r\n\t\tvar me = this;\r\n\t\tvar valid = true;\r\n\r\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\r\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\r\n\t\t\t\tif (!me.frm.doc[fieldname]) {\r\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\r\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\r\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid;\r\n\t},\r\n\r\n\tget_terms: function() {\r\n\t\tvar me = this;\r\n\r\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\r\n\t\t\tif(!r.exc) {\r\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\ttaxes_and_charges: function() {\r\n\t\tvar me = this;\r\n\t\tif(this.frm.doc.taxes_and_charges) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\r\n\t\t\t\t\t\tthis.frm.doc.name).options,\r\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\r\n\t\t\t\t\t\t\tfor (let tax of r.message) {\r\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\r\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\ttax_category: function() {\r\n\t\tvar me = this;\r\n\t\tif(me.frm.updating_party_details) return;\r\n\r\n\t\tfrappe.run_serially([\r\n\t\t\t() => this.update_item_tax_map(),\r\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\r\n\t\t]);\r\n\t},\r\n\r\n\titem_tax_template: function(doc, cdt, cdn) {\r\n\t\tvar me = this;\r\n\t\tif(me.frm.updating_party_details) return;\r\n\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\r\n\t\tif(item.item_tax_template) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tcompany: me.frm.doc.company,\r\n\t\t\t\t\titem_tax_template: item.item_tax_template,\r\n\t\t\t\t\tas_json: true\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\titem.item_tax_rate = r.message;\r\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\r\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\titem.item_tax_rate = \"{}\";\r\n\t\t\tme.calculate_taxes_and_totals();\r\n\t\t}\r\n\t},\r\n\r\n\tupdate_item_tax_map: function() {\r\n\t\tvar me = this;\r\n\t\tvar item_codes = [];\r\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\r\n\t\t\tif(item.item_code) {\r\n\t\t\t\titem_codes.push(item.item_code);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(item_codes.length) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tcompany: me.frm.doc.company,\r\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\r\n\t\t\t\t\titem_codes: item_codes\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(!r.exc) {\r\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\r\n\t\t\t\t\t\t\tif(item.item_code && r.message.hasOwnProperty(item.item_code)) {\r\n\t\t\t\t\t\t\t\tif (!item.item_tax_template) {\r\n\t\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.item_code].item_tax_template;\r\n\t\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.item_code].item_tax_rate;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\titem.item_tax_template = \"\";\r\n\t\t\t\t\t\t\t\titem.item_tax_rate = \"{}\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tis_recurring: function() {\r\n\t\t// set default values for recurring documents\r\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\r\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\r\n\t\t\tthis.frm.set_value('is_recurring', 0);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.frm.doc.is_recurring) {\r\n\t\t\tif(!this.frm.doc.recurring_id) {\r\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\r\n\t\t\t}\r\n\r\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\r\n\t\t\t\t? frappe.user_info(\"Administrator\").email\r\n\t\t\t\t: this.frm.doc.owner;\r\n\r\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\r\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\r\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\r\n\t\t}\r\n\r\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\r\n\t},\r\n\r\n\tfrom_date: function() {\r\n\t\t// set to_date\r\n\t\tif(this.frm.doc.from_date) {\r\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\r\n\t\t\t\t'Yearly': 12};\r\n\r\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\r\n\t\t\tif(months) {\r\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\r\n\t\t\t\t\tmonths);\r\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\r\n\t\t\t\trefresh_field('to_date');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tset_gross_profit: function(item) {\r\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\r\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\r\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\r\n\t\t}\r\n\t},\r\n\r\n\tsetup_item_selector: function() {\r\n\t\t// TODO: remove item selector\r\n\r\n\t\treturn;\r\n\t\t// if(!this.item_selector) {\r\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\r\n\t\t// }\r\n\t},\r\n\r\n\tget_advances: function() {\r\n\t\tif(!this.frm.is_return) {\r\n\t\t\treturn this.frm.call({\r\n\t\t\t\tmethod: \"set_advances\",\r\n\t\t\t\tdoc: this.frm.doc,\r\n\t\t\t\tcallback: function(r, rt) {\r\n\t\t\t\t\trefresh_field(\"advances\");\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tmake_payment_entry: function() {\r\n\t\treturn frappe.call({\r\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\r\n\t\t\targs: {\r\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\r\n\t\t\t\t\"dn\": cur_frm.doc.name\r\n\t\t\t},\r\n\t\t\tcallback: function(r) {\r\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\r\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\r\n\t\t\t\t// cur_frm.refresh_fields()\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tget_method_for_payment: function(){\r\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\r\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\r\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\r\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\r\n\t\t\t}else {\r\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn method\r\n\t},\r\n\r\n\tset_query_for_batch: function(doc, cdt, cdn) {\r\n\t\t// Show item's batches in the dropdown of batch no\r\n\r\n\t\tvar me = this;\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\r\n\t\tif(!item.item_code) {\r\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\r\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\r\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\r\n\t\t\treturn {\r\n\t\t\t\tfilters: {'item': item.item_code}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet filters = {\r\n\t\t\t\t'item_code': item.item_code,\r\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\r\n\t\t\t}\r\n\r\n\t\t\tif (doc.is_return) {\r\n\t\t\t\tfilters[\"is_return\"] = 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\r\n\t\t\t\tfilters: filters\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tset_query_for_item_tax_template: function(doc, cdt, cdn) {\r\n\t\tvar item = frappe.get_doc(cdt, cdn);\r\n\t\tif(!item.item_code) {\r\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\r\n\t\t} else {\r\n\t\t\tlet filters = {\r\n\t\t\t\t'item_code': item.item_code,\r\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\r\n\t\t\t\t'item_group': item.item_group,\r\n\t\t\t}\r\n\r\n\t\t\tif (doc.tax_category)\r\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\r\n\t\t\tif (doc.company)\r\n\t\t\t\tfilters['company'] = doc.company;\r\n\t\t\treturn {\r\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\r\n\t\t\t\tfilters: filters\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tpayment_terms_template: function() {\r\n\t\tvar me = this;\r\n\t\tconst doc = this.frm.doc;\r\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\r\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tterms_template: doc.payment_terms_template,\r\n\t\t\t\t\tposting_date: posting_date,\r\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\r\n\t\t\t\t\tbase_grand_total: doc.base_rounded_total || doc.base_grand_total,\r\n\t\t\t\t\tbill_date: doc.bill_date\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(r.message && !r.exc) {\r\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\r\n\t\t\t\t\t\tconst company_currency = me.get_company_currency();\r\n\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tpayment_term: function(doc, cdt, cdn) {\r\n\t\tconst me = this;\r\n\t\tvar row = locals[cdt][cdn];\r\n\t\tif(row.payment_term) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tterm: row.payment_term,\r\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\r\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\r\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\r\n\t\t\t\t\tbase_grand_total: this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif(r.message && !r.exc) {\r\n\t\t\t\t\t\tfor (var d in r.message) {\r\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\r\n\t\t\t\t\t\t\tconst company_currency = me.get_company_currency();\r\n\t\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tagainst_blanket_order: function(doc, cdt, cdn) {\r\n\t\tvar item = locals[cdt][cdn];\r\n\t\tif(!item.against_blanket_order) {\r\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\r\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\r\n\t\t}\r\n\t},\r\n\r\n\tblanket_order: function(doc, cdt, cdn) {\r\n\t\tvar me = this;\r\n\t\tvar item = locals[cdt][cdn];\r\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\targs:{\r\n\t\t\t\t\t\titem_code: item.item_code,\r\n\t\t\t\t\t\tcustomer: doc.customer,\r\n\t\t\t\t\t\tsupplier: doc.supplier,\r\n\t\t\t\t\t\tcompany: doc.company,\r\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\r\n\t\t\t\t\t\tblanket_order: item.blanket_order\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\tif (!r.message) {\r\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfrappe.run_serially([\r\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\r\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\r\n\t\t\t\t\t\t]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\tset_reserve_warehouse: function() {\r\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\r\n\t},\r\n\r\n\tset_warehouse: function() {\r\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\r\n\t},\r\n\r\n\tset_target_warehouse: function() {\r\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"target_warehouse\", this.frm.doc.set_target_warehouse);\r\n\t},\r\n\r\n\tset_from_warehouse: function() {\r\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"from_warehouse\", this.frm.doc.set_from_warehouse);\r\n\t},\r\n\r\n\tautofill_warehouse : function (child_table, warehouse_field, warehouse) {\r\n\t\tif (warehouse && child_table && child_table.length) {\r\n\t\t\tlet doctype = child_table[0].doctype;\r\n\t\t\t$.each(child_table || [], function(i, item) {\r\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tcoupon_code: function() {\r\n\t\tvar me = this;\r\n\t\tfrappe.run_serially([\r\n\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\r\n\t\t\t() => me.ignore_pricing_rule(),\r\n\t\t\t() => this.frm.doc.ignore_pricing_rule=0,\r\n\t\t\t() => me.apply_pricing_rule()\r\n\t\t]);\r\n\t}\r\n});\r\n\r\nerpnext.show_serial_batch_selector = function (frm, d, callback, on_close, show_dialog) {\r\n    //console.log('trans')\r\n\tlet warehouse, receiving_stock, existing_stock;\r\n\tif (frm.doc.is_return) {\r\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\r\n\t\t\texisting_stock = true;\r\n\t\t\twarehouse = d.warehouse;\r\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\r\n\t\t\treceiving_stock = true;\r\n\t\t}\r\n\t} else {\r\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\r\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\r\n\t\t\t\treceiving_stock = true;\r\n\t\t\t} else {\r\n\t\t\t\texisting_stock = true;\r\n\t\t\t\twarehouse = d.s_warehouse;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\texisting_stock = true;\r\n\t\t\twarehouse = d.warehouse;\r\n\t\t}\r\n\t}\r\n\r\n\tif (!warehouse) {\r\n\t\tif (receiving_stock) {\r\n\t\t\twarehouse = [\"like\", \"\"];\r\n\t\t} else if (existing_stock) {\r\n\t\t\twarehouse = [\"!=\", \"\"];\r\n\t\t}\r\n\t}\r\n    //console.log(\"vimdev\")\r\n\tfrappe.require([\"assets/vim/js/utils/serial_no_batch_selector.js\",\"assets/vim/css/serial_no_batch_selector.css\"], function() {\r\n\t\tnew erpnext.SerialNoBatchSelector({\r\n\t\t\tfrm: frm,\r\n\t\t\titem: d,\r\n\t\t\twarehouse_details: {\r\n\t\t\t\ttype: \"Warehouse\",\r\n\t\t\t\tname: warehouse\r\n\t\t\t},\r\n\t\t\tcallback: callback,\r\n\t\t\ton_close: on_close\r\n\t\t}, show_dialog);\r\n\t});\r\n}\r\n\r\nerpnext.apply_putaway_rule = (frm, purpose=null) => {\r\n\tif (!frm.doc.company) {\r\n\t\tfrappe.throw({message: __(\"Please select a Company first.\"), title: __(\"Mandatory\")});\r\n\t}\r\n\tif (!frm.doc.items.length) return;\r\n\r\n\tfrappe.call({\r\n\t\tmethod: \"erpnext.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule\",\r\n\t\targs: {\r\n\t\t\tdoctype: frm.doctype,\r\n\t\t\titems: frm.doc.items,\r\n\t\t\tcompany: frm.doc.company,\r\n\t\t\tsync: true,\r\n\t\t\tpurpose: purpose\r\n\t\t},\r\n\t\tcallback: (result) => {\r\n\t\t\tif (!result.exc && result.message) {\r\n\t\t\t\tfrm.clear_table(\"items\");\r\n\r\n\t\t\t\tlet items =  result.message;\r\n\t\t\t\titems.forEach((row) => {\r\n\t\t\t\t\tdelete row[\"name\"]; // dont overwrite name from server side\r\n\t\t\t\t\tlet child = frm.add_child(\"items\");\r\n\t\t\t\t\tObject.assign(child, row);\r\n\t\t\t\t\tfrm.script_manager.trigger(\"qty\", child.doctype, child.name);\r\n\t\t\t\t});\r\n\t\t\t\tfrm.get_field(\"items\").grid.refresh();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});","frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://erpnext.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/rename-user\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/setting-up/users-and-permissions/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"data-import-tool\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import-tool\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Naming Series\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/naming-series\",\n\t},\n\t{\n\t\tlabel: \"Setting the Current Value for Naming Series\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/naming-series-current-value\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/integrations/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/integrations/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/integrations/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/setting-up/integrations/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/integrations/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/selling/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/selling/setup/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling/setup/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying/setup/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/pos-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/stock-reconciliation-for-non-serialized-item\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Backup\"] = [\n\t{\n\t\tlabel: \"Dropbox Backup\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/third-party-backups\",\n\t},\n\t{\n\t\tlabel: \"Setting Up Dropbox Backup\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/setting-up-dropbox-backups\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [\n\t{ label: \"Workflow\", url: docsUrl + \"user/manual/en/setting-up/workflows\" },\n];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Managing Multiple Companies\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/managing-multiple-companies\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"modules/Accounts\"] = [\n\t{\n\t\tlabel: \"Introduction to Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/\",\n\t},\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/chart-of-accounts.html\",\n\t},\n\t{\n\t\tlabel: \"Multi Currency Accounting\",\n\t\turl: docsUrl + \"user/manual/en/accounts/multi-currency-accounting\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-accounts\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-accounts\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"pos\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/point-of-sale-pos-invoice\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/pos-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-accounts\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-accounts\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/accounts/managing-fixed-assets\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/accounts/managing-fixed-assets\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-wise-taxation\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/accounts/managing-fixed-assets\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/item/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-wise-taxation\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/accounts/managing-fixed-assets\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/item/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/stock/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree\"] = [\n\t{\n\t\tlabel: \"Managing Tree Structure Masters\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/stock/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/stock/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/stock/tools/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/stock/tools/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/stock/tools/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/stock/setup/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/stock/setup/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/opening-stock\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [\n\t{ label: \"Lead\", url: docsUrl + \"user/manual/en/CRM/lead\" },\n];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/CRM/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [\n\t{ label: \"Address\", url: docsUrl + \"user/manual/en/CRM/address\" },\n];\n\nfrappe.help.help_links[\"Form/Contact\"] = [\n\t{ label: \"Contact\", url: docsUrl + \"user/manual/en/CRM/contact\" },\n];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/CRM/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [\n\t{ label: \"Campaign\", url: docsUrl + \"user/manual/en/CRM/setup/campaign\" },\n];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/CRM/setup/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/setup/sales-person-target-allocation\",\n\t},\n];\n\n//Support\n\nfrappe.help.help_links[\"List/Feedback Trigger\"] = [\n\t{\n\t\tlabel: \"Feedback Trigger\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/feedback/setting-up-feedback\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Feedback Request\"] = [\n\t{\n\t\tlabel: \"Feedback Request\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/feedback/submit-feedback\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Feedback Request\"] = [\n\t{\n\t\tlabel: \"Feedback Request\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/feedback/submit-feedback\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/manufacturing/articles/nested-bom-structure\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/tools/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis.check_naming_series_based_on();\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tcheck_naming_series_based_on: function() {\n\t\tif (frappe.defaults.get_default(\"item_naming_by\") === \"Naming Series\") {\n\t\t\tthis.mandatory = this.mandatory.filter(d => d.fieldname !== \"item_code\");\n\t\t}\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis.skip_redirect_on_error = true;\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})","frappe.provide('erpnext.hub');\n\nfrappe.views.MarketplaceFactory = class MarketplaceFactory extends frappe.views.Factory {\n\tshow() {\n\t\tis_marketplace_disabled()\n\t\t\t.then(disabled => {\n\t\t\t\tif (disabled) {\n\t\t\t\t\tfrappe.show_not_found('Marketplace');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (frappe.pages.marketplace) {\n\t\t\t\t\tfrappe.container.change_to('marketplace');\n\t\t\t\t\terpnext.hub.marketplace.refresh();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make('marketplace');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tmake(page_name) {\n\t\tconst assets = [\n\t\t\t'/assets/js/marketplace.min.js'\n\t\t];\n\n\t\tfrappe.require(assets, () => {\n\t\t\terpnext.hub.marketplace = new erpnext.hub.Marketplace({\n\t\t\t\tparent: this.make_page(true, page_name)\n\t\t\t});\n\t\t});\n\t}\n};\n\nfunction is_marketplace_disabled() {\n\treturn frappe.call({\n\t\tmethod: \"erpnext.hub_node.doctype.marketplace_settings.marketplace_settings.is_marketplace_enabled\"\n\t}).then(r => r.message)\n}\n","class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass('call-popup');\n\t\tthis.dialog.get_close_btn().unbind('click').click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('green');\n\t\t} else if (['No Answer', 'Missed'].includes(call_status)) {\n\t\t\tthis.set_indicator('yellow');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Busy', 'Failed'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Ended');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? 'Missed': null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find(d => d.link_doctype === 'Contact');\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, call_log => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, call_log => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [{\n\t\t\t\t'fieldname': 'name',\n\t\t\t\t'label': 'Name',\n\t\t\t\t'default': this.get_caller_name() || __('Unknown Caller'),\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Contact'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Contact', this.get_contact_link().link_name),\n\t\t\t\t'depends_on': () => this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Contact'),\n\t\t\t\t'click': this.create_new_contact.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Customer'),\n\t\t\t\t'click': this.create_new_customer.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Lead'),\n\t\t\t\t'click': () => frappe.new_doc('Lead', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldname': 'number',\n\t\t\t\t'label': 'Phone Number',\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'default': this.caller_number,\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.call_details.get_value('call_summary');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('erpnext.telephony.doctype.call_log.call_log.add_call_summary', {\n\t\t\t\t\t\t'call_log': this.call_log.name,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__('Call Summary Saved')}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__('View call log')}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t\tbody: this.caller_info\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc('Customer');\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route('Form', new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc('Contact');\n\t\tconst phone_no = frappe.model.add_child(new_contact, 'Contact Phone', 'phone_nos');\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route('Form', new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tlet call_popup = erpnext.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n","frappe.provide('erpnext.accounts');\n\nerpnext.accounts.dimensions = {\n\tsetup_dimension_filters(frm, doctype) {\n\t\tthis.accounting_dimensions = [];\n\t\tthis.default_dimensions = {};\n\t\tthis.fetch_custom_dimensions(frm, doctype);\n\t},\n\n\tfetch_custom_dimensions(frm, doctype) {\n\t\tlet me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\targs: {\n\t\t\t\t'with_cost_center_and_project': true\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.accounting_dimensions = r.message[0];\n\t\t\t\tme.default_dimensions = r.message[1];\n\t\t\t\tme.setup_filters(frm, doctype);\n\t\t\t}\n\t\t});\n\t},\n\n\tsetup_filters(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension['document_type'], () => {\n\t\t\t\t\tlet parent_fields = [];\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\t\tparent_fields.push(df.fieldname);\n\t\t\t\t\t\t} else if (df.fieldtype === 'Table') {\n\t\t\t\t\t\t\tthis.setup_child_filters(frm, df.options, df.fieldname, dimension['fieldname']);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\tthis.setup_account_filters(frm, dimension['fieldname'], parent_fields);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_child_filters(frm, doctype, parentfield, dimension) {\n\t\tlet fields = [];\n\n\t\tif (frappe.meta.has_field(doctype, dimension)) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\tfields.push(df.fieldname);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrm.set_query(dimension, parentfield, function(doc, cdt, cdn) {\n\t\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\t\treturn erpnext.queries.get_filtered_dimensions(row, fields, dimension, doc.company);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_account_filters(frm, dimension, fields) {\n\t\tfrm.set_query(dimension, function(doc) {\n\t\t\treturn erpnext.queries.get_filtered_dimensions(doc, fields, dimension, doc.company);\n\t\t});\n\t},\n\n\tupdate_dimension(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tif (frm.is_new()) {\n\t\t\t\t\tif (frm.doc.company && Object.keys(this.default_dimensions || {}).length > 0\n\t\t\t\t\t\t&& this.default_dimensions[frm.doc.company]) {\n\n\t\t\t\t\t\tlet default_dimension = this.default_dimensions[frm.doc.company][dimension['fieldname']];\n\n\t\t\t\t\t\tif (default_dimension) {\n\t\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\t\tfrm.set_value(dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.each(frm.doc.items || frm.doc.accounts || [], function(i, row) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcopy_dimension_from_first_row(frm, cdt, cdn, fieldname) {\n\t\tif (frappe.meta.has_field(frm.doctype, fieldname) && this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tlet row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(fieldname, row, [dimension['fieldname']]);\n\t\t\t});\n\t\t}\n\t}\n};","frappe.ui.form.ControlData = frappe.ui.form.ControlData.extend( {\n\tmake_input() {\n\t\tthis._super();\n\t\tif (this.df.options == 'Phone') {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function(field) {\n\t\t\t\tif (field.df.read_only === 1 && field.df.options === 'Phone' \n\t\t\t\t\t&& field.disp_area.style[0] != 'display' && !field.has_icon) {\n\t\t\t\t\tfield.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? '.control-value' : '.control-input';\n\t\t\tthis.$wrapper.find(control)\n\t\t\t\t.append(`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__('Make a call')}\">\n\t\t\t\t\t\t\t${frappe.utils.icon('call')}\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t\t.find('.phone-btn')\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n});\n"],"names":["attach_selector_button","inner_text","append_loction","context","grid_row","let","$btn_div","$","css","margin-bottom","margin-top","appendTo","on","show_serial_batch_selector","frm","doc","frappe","provide","extend","breadcrumbs","preferred","Item Group","Customer Group","Supplier Group","Territory","Sales Person","Sales Partner","Brand","Maintenance Schedule","Maintenance Visit","module_map","ERPNext Integrations","Geo","Portal","Utilities","Shopping Cart","Contacts","erpnext","get_currency","company","cur_frm","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","const","currency_list","docs","filter","d","doctype","map","name","unshift","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_or_batch_no","open_grid_row","grid_form","serial_no","get_status","model","get_value","item_code","ref","assign","has_serial_no","has_batch_no","__","$wrapper","this","batch_no","route_to_adjustment_jv","args","with_doctype","journal_entry","get_new_doc","accounts","forEach","je_account","child_row","add_child","account","debit_in_account_currency","credit_in_account_currency","party_type","set_route","utils","set_party_dashboard_indicators","__onload","dashboard_info","company_wise_info","info","add_indicator_for_multicompany","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","loyalty_points","stats_area","removeClass","stats_area_row","addClass","color","indicator","get_party_name","Customer","Supplier","Employee","Member","copy_value_in_all_rows","dt","dn","table_fieldname","fieldname","cl","i","refresh_field","get_terms","tc_name","callback","call","method","template_name","r","make_bank_account","docname","freeze","doclist","sync","message","add_dimensions","report_name","index","filters","query_reports","dimension","some","el","splice","label","fieldtype","options","make_subscription","make_pricing_rule","first_row_is_empty","child_table","isArray","remove_empty_first_row","child_table_name","rows","get_tree_options","option","unscrub_option","unscrub","user_permission","defaults","get_user_permissions","perm","c","sort","value","self","indexOf","get_tree_default","includes","get_default","overrides_parent_value_in_all_rows","parent_fieldname","create_new_doc","update_fields","new_doc","entries","key","ui","form","make_quick_entry","select_alternate_items","opts","warehouse_field","item_field","data","dialog","Dialog","title","fields","cannot_add_rows","in_place_edit","get_data","hidden","in_list_view","read_only","default","onchange","warehouse","on_grid_fields_dict","actual_qty","get_query","e","query","primary_action","get_values","alternate_item","row","child_doctype","qty","required_qty","script_manager","trigger","then","original_item_field","child_docname","hide","primary_action_label","condition","alternative_items","df","push","grid","refresh","show","update_child_items","cannot_add_row","child_meta","get_meta","get_precision","find","f","precision","disabled","reqd","uom","exc","conversion_factor","trans_items","parent_doctype","parent_doctype_name","reload_doc","delivery_date","schedule_date","rate","map_current_doc","_map","items","items_doctype","meta","get_docfield","link_fieldname","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","dirty","query_args","get_query_filters","get_query_method","MultiSelectDialog","target","date_field","undefined","setters","add_filters_group","action","selections","values","link_formatters","item_name","employee_name","project_name","project","document","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","item","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","company_address_query","is_your_company_address","supplier_filter","lead_filter","not_a_group_filter","is_group","employee","cstr","get_filtered_dimensions","child_fields","field","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","me","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","party_name","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","get_party_details","company_address","shipping_address","quotation_to","party","price_list","selling_price_list","bill_date","buying_price_list","shipping_address_name","posting_date","transaction_date","validate_mandatory","supplier_tds","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","get_address_display","address_field","display_field","address_dict","set_taxes_from_address","triggered_from_field","billing_address_field","shipping_address_field","tax_category","billing_address","set_taxes","customer_group","supplier_group","get_contact_details","trigger_on","get_shipping_address","inter_com_order_reference","internal_invoice_reference","internal_order_reference","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","moment","modified","format","show_cancelled_entries","show_general_ledger","group_by","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","click","select","set_primary_action","amount","submit_invoice","empty","html","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","val","conversion_rate","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","attr","update_paid_amount","change","write_off_amount","selected_row","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","fetch_round_off_accounts","apply_pricing_rule_on_item","effective_item_rate","price_list_rate","item_rate","parenttype","blanket_order_rate","margin_type","rate_with_margin","margin_rate_or_amount","base_rate_with_margin","discount_percentage","discount_amount","calculate_taxes_and_totals","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","is_return","calculate_total_advance","is_pos","update_paid_amount_for_return","calculate_commission","calculate_contribution","grand_total","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","subs","err_message","round_floats_in","net_rate","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","tax","item_wise_tax_detail","tax_fields","charge_type","apply_discount_on","cscript","validate_taxes_and_charges","validate_inclusive_tax","flags","round_off_applicable_accounts","account_list","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","total_inclusive_tax_amount_per_qty","current_tax_fraction","get_current_tax_fraction","tax_fraction_for_current_item","inclusive_tax_amount_per_qty","grand_total_fraction_for_current_item","tax_rate","_get_tax_rate","row_id","add_deduct_tax","account_head","total_qty","total","base_total","net_total","base_net_total","base_amount","base_net_amount","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","round_off_base_values","set_cumulative_total","row_idx","JSON","parse","actual","set_item_wise_tax","tax_detail","item_wise_tax_amount","Math","round","base_tax_amount","base_tax_amount_after_discount_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","abs","pow","tax_count","base_grand_total","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","base_discount_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","is_internal_invoice","represents_company","calculate_paid_amount","party_account_currency","total_amount_to_pay","total_amount_for_payment","redeem_loyalty_points","loyalty_amount","set_default_payment","calculate_change_amount","base_paid_amount","pay","payment_status","base_change_amount","payment_types","TransactionController","_super","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","calculate_stock_uom_rate","tax_table","set_dynamic_labels","via_discount_percentage","items_add","set_warehouse","target_warehouse","set_target_warehouse","from_warehouse","set_from_warehouse","dimensions","copy_dimension_from_first_row","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","set_indicator_formatter","batch_no_field","get_route_options_for_new_doc","blanket_order_type","taxes_and_charges","get_user_default","amended_from","return_against","setup_quality_inspection","inspection_type","reference_type","reference_name","description","item_serial_no","split","make_payment_request","payment_request_type","recipient_id","contact_email","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","set_multiple_add","setup_sms","scan_barcode_field","set_new_description","is_mobile","$input_wrapper","$input_group","append","$input","barcode","scan_barcode","search_value","exist","cur_grid","row_to_modify","existing_item_row","blank_item_row","show_alert","from_barcode","taxes_and_charges_field","master_doctype","tax_template","debounce","status","page","add_menu_item","send_sms","update_stock","show_batch_dialog","validate_company_and_party","child","price_list_currency","plc_conversion_rate","order_type","is_subcontracted","ignore_pricing_rule","weight_uom","manufacturer","stock_uom","pos_profile","cost_center","item_tax_template","add_taxes_from_item_tax_template","free_item_data","apply_product_discount","is_internal_customer","is_internal_supplier","get_incoming_rate","toggle_conversion_factor","db","get_single_value","k","remove_pricing_rule","apply_rule_on_other_items","update_item_grid_labels","grid_rows","remove","voucher_type","item_args","allow_zero_valuation_rate","replace","user_defaults","set_qty_in_transactions_based_on_serial_no_input","setTimeout","update_qty","serialnos","valid_serial_nos","validate","set_default_internal_warehouse","default_in_transit_warehouse","set_pricing","company_doc","default_letter_head","letter_head","default_selling_terms","default_buying_terms","update_item_tax_map","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","get_exchange_rate","exchange_rate","set_margin_amount_based_on_currency","set_actual_charges_based_on_currency","in_apply_price_list","apply_price_list","shipping_rule","fail","from_currency","to_currency","freeze_message","dont_fetch_price_list_rate","fields_map","toggle_enable","stock_uom_rate","service_stop_date","start_date","Date","service_start_date","end_date","service_end_date","stop_date","total_net_weight","toggle_reqd","price_list_name","change_form_labels","change_grid_labels","set_currency_labels","toggle_item_grid_columns","operations","item_grid","fname","set_column_disp","scrap_items","advances","update_payment_schedule_grid_labels","schedule_grid","recalculate","recalculate_values","calculate_charges","item_list","is_free_item","pricing_rules","parent","row_item","_set_values_for_item_list","_get_args","_get_item_list","territory","campaign","sales_partner","coupon_code","append_item","item_group","brand","children","price_list_rate_changed","items_rule_dict","l","existing_pricing_rule","apply_rule_on","price_or_product_discount","exist_items","pr_row","parent_item_row","reset_plc_conversion","always","remove_free_item","applied_on_items","apply_on","trigger_price_list_rate","valid","master_name","as_json","item_codes","hasOwnProperty","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","join","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","make_payment_via_journal_entry","set_query_for_item_tax_template","valid_from","terms_template","against_blanket_order","blanket_order","set_reserve_warehouse","autofill_warehouse","supplied_items","on_close","receiving_stock","existing_stock","purpose","s_warehouse","require","SerialNoBatchSelector","warehouse_details","apply_putaway_rule","result","clear_table","ItemSelector","Class","init","item_query","add_items_button","render_items","focus","results","timeout_id","clearTimeout","added","add_new_row","timeout","txt","as_dict","get_filters","link_search","image","abbr","get_abbr","get_palette","docsUrl","help","help_links","url","agriculture","TernaryPlot","[object Object]","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","soil_type","polygon","get_coords","fill","get_color","transform","offset","exec_once","rect","font-size","x_blip","y_blip","sin","blip","circle","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","concat","get_attributes_fields","check_naming_series_based_on","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_form_if_not_list","error","open_doc","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","wrapper","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","async","prototype","toString","msgprint_dialog","CustomerQuickEntryForm","skip_redirect_on_error","collapsible","views","MarketplaceFactory","Factory","show_not_found","pages","marketplace","container","change_to","hub","make","page_name","Marketplace","make_page","CallPopup","call_log","caller_number","from","setup_listener","play_sound","static","minimizable","get_close_btn","setup_dialog","set_call_status","bind_actions_with_object","unbind","close_modal","bind","setup_call_details","caller_info","blink","classes","header","call_status","get_caller_name","set_indicator","set_title","missed","call_popup","update_call_log","clear_listeners","contact_link","get_contact_link","link_title","links","realtime","call_ended","off","call_details","FieldGroup","depends_on","create_new_contact","create_new_customer","hide_border","call_summary","xcall","summary","Boolean","new_customer","new_contact","phone_no","phone","is_primary_mobile_no","window","setup_dimension_filters","accounting_dimensions","default_dimensions","fetch_custom_dimensions","with_cost_center_and_project","setup_filters","parent_fields","setup_child_filters","setup_account_filters","update_dimension","default_dimension","copy_from_first_row","ControlData","setup_phone","disp_area","style","has_icon","phone_call","handler","control","icon"],"mappings":"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"}